(()=>{var c=class e{_x;_y;_z;attachment;constructor(t,n,i,a){this._x=t,this._y=n,this._z=i,this.attachment=a}add(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)}addAssign(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}sub(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)}subAssign(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}scale(t){return new e(this.x*t,this.y*t,this.z*t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}get normalized(){return this.scale(1/this.magnitude)}set x(t){this.attachment&&o(this.attachment.add("x"),t),this._x=t}get x(){return this.attachment&&(this._x=r(this.attachment.add("x"))),this._x}set y(t){this.attachment&&o(this.attachment.add("y"),t),this._y=t}get y(){return this.attachment&&(this._y=r(this.attachment.add("y"))),this._y}set z(t){this.attachment&&o(this.attachment.add("z"),t),this._z=t}get z(){return this.attachment&&(this._z=r(this.attachment.add("z"))),this._z}};var d=class e{_position;_rotation;_scale;attachment;static getComponentId(){return acro.COMPONENT_IDS.Transform}static createDefault(t){return new e(new c(0,0,0),new c(0,0,0),new c(1,1,1),t)}constructor(t,n,i,a){this._position=t,this._rotation=n,this._scale=i,this.attachment=a}get position(){return this.attachment&&(this._position=b(this.attachment.add("position"))),this._position}set position(t){if(this.attachment){let n=this.attachment.add("position");y(n,t),t.attachment=n}this._position=t}get rotation(){return this.attachment&&(this._rotation=b(this.attachment.add("rotation"))),this._rotation}set rotation(t){if(this.attachment){let n=this.attachment.add("rotation");y(n,t),t.attachment=n}this._rotation=t}get scale(){return this.attachment&&(this._scale=b(this.attachment.add("scale"))),this._scale}set scale(t){if(this.attachment){let n=this.attachment.add("scale");y(n,t),t.attachment=n}this._scale=t}get forward(){return new c(Math.cos(-this.rotation.x)*Math.sin(-this.rotation.y),-Math.sin(-this.rotation.x),Math.cos(-this.rotation.x)*Math.cos(-this.rotation.y)).normalized}get right(){return new c(Math.cos(-this.rotation.y),0,-Math.sin(-this.rotation.y)).normalized}get up(){return this.forward.cross(this.right)}};var m=class e{_x;_y;attachment;constructor(t,n,i){this._x=t,this._y=n,this.attachment=i}add(t){return new e(this.x+t.x,this.y+t.y)}addAssign(t){this.x+=t.x,this.y+=t.y}sub(t){return new e(this.x-t.x,this.y-t.y)}subAssign(t){this.x-=t.x,this.y-=t.y}scale(t){return new e(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){return this.scale(1/this.magnitude)}set x(t){this.attachment&&o(this.attachment.add("x"),t),this._x=t}get x(){return this.attachment&&(this._x=r(this.attachment.add("x"))),this._x}set y(t){this.attachment&&o(this.attachment.add("y"),t),this._y=t}get y(){return this.attachment&&(this._y=r(this.attachment.add("y"))),this._y}};function V(e){return Deno.core.ops.op_get_property_string(e.entity.generation,e.entity.index,e.componentId,e.path)}function M(e,t){Deno.core.ops.op_set_property_string(e.entity.generation,e.entity.index,e.componentId,e.path,t)}function r(e){return Deno.core.ops.op_get_property_number(e.entity.generation,e.entity.index,e.componentId,e.path)}function o(e,t){Deno.core.ops.op_set_property_number(e.entity.generation,e.entity.index,e.componentId,e.path,t)}function I(e){return Deno.core.ops.op_get_property_boolean(e.entity.generation,e.entity.index,e.componentId,e.path)}function C(e,t){Deno.core.ops.op_set_property_boolean(e.entity.generation,e.entity.index,e.componentId,e.path,t)}function b(e){throw new Error("getPropertyVec3 not implemented in browser!")}function y(e,t){Deno.core.ops.op_set_property_vec3(e.entity.generation,e.entity.index,e.componentId,e.path,t.x,t.y,t.z)}function D(e,t){Deno.core.ops.op_call_function(e.entity.generation,e.entity.index,e.componentId,e.path,t)}var g=class{COMPONENT_IDS;behaviorConstructors;behaviors;constructor(){this.COMPONENT_IDS={},this.behaviorConstructors={},this.behaviors=new Map}update(t){for(let n of this.behaviors.values())n.update(t)}registerBehavior(t,n){let i=!!this.behaviorConstructors[t];if(this.behaviorConstructors[t]=n,i)for(let[a,h]of this.behaviors)this.createBehavior(h.entity.generation,h.entity.index,a,t)}createBehavior(t,n,i,a,...h){let w=new this.behaviorConstructors[a](new u(t,n),...h);this.behaviors.set(i,w)}registerComponents(t){acro.COMPONENT_IDS=t}};var u=class{generation;index;constructor(t,n){this.generation=t,this.index=n}newAttachment(t,n){return new z(this,t,n)}getComponent(t){let n=this.newAttachment(t.getComponentId(),"");return t.createDefault(n)}},z=class e{entity;componentId;path;constructor(t,n,i){this.entity=t,this.componentId=n,this.path=i}add(t){return new e(this.entity,this.componentId,this.path+"."+t)}},p=class{entity;transform;constructor(t){this.entity=t,this.transform=this.getComponent(d)}getComponent(t){return this.entity.getComponent(t)}update(t){}},A=e=>{let t=Deno.core.ops.op_get_entity_by_absolute_path(e);return t?new u(t.generation,t.index):null};var _=class{attachment;handlers;constructor(t){this.attachment=t,this.handlers=[]}bind(t){this.handlers.push(t),this.attachment&&D(this.attachment.add("bind"),[t])}};var E=()=>{globalThis.acro=new g};var S=e=>Deno.core.ops.op_get_key_press(JSON.stringify(e)),L=e=>Deno.core.ops.op_get_mouse_press(JSON.stringify(e)),T=()=>{let[e,t]=Deno.core.ops.op_get_mouse_position();return new m(e,t)},s={isKeyPressed:S,isMousePressed:L,getMousePosition:T};var x=class e{_content;_fontSize;_lineHeight;_weight;_italic;attachment;static getComponentId(){return acro.COMPONENT_IDS.Text}static createDefault(t){return new e("",14,16,400,!1,t)}constructor(t,n,i,a,h,w){this._content=t,this._fontSize=n,this._lineHeight=i,this._weight=a,this._italic=h,this.attachment=w}get content(){return this.attachment&&(this._content=V(this.attachment.add("content"))),this._content}set content(t){this.attachment&&M(this.attachment.add("content"),t),this._content=t}get fontSize(){return this.attachment&&(this._fontSize=r(this.attachment.add("font_size"))),this._fontSize}set fontSize(t){this.attachment&&o(this.attachment.add("font_size"),t),this._fontSize=t}get lineHeight(){return this.attachment&&(this._lineHeight=r(this.attachment.add("line_height"))),this._lineHeight}set lineHeight(t){this.attachment&&o(this.attachment.add("line_height"),t),this._lineHeight=t}get weight(){return this.attachment&&(this._weight=r(this.attachment.add("weight"))),this._weight}set weight(t){this.attachment&&o(this.attachment.add("weight"),t),this._weight=t}get italic(){return this.attachment&&(this._italic=I(this.attachment.add("italic"))),this._italic}set italic(t){this.attachment&&C(this.attachment.add("italic"),t),this._italic=t}};var f=class e{click;static getComponentId(){return acro.COMPONENT_IDS.Button}static createDefault(t){return new e(t)}constructor(t){this.click=new _(t?.add("click"))}};var v=class extends p{text;button;constructor(t){super(t),this.text=A("/UI/Panel/Text")?.getComponent(x),this.button=A("/UI/Panel 2")?.getComponent(f),this.button.click.bind(()=>this.transform.position.y+=1)}update(t){s.isMousePressed("Left")&&(this.transform.rotation.y-=5*t),s.isMousePressed("Right")&&(this.transform.rotation.z+=5*t),this.text.content=`y rotation (radians): ${this.transform.rotation.y.toFixed(2)}`}},k=()=>acro.registerBehavior("TestBehavior",v);var l=20;var P=class extends p{lastMousePosition=new m(0,0);constructor(t){super(t)}update(t){let i=s.getMousePosition().sub(this.lastMousePosition);this.lastMousePosition=s.getMousePosition(),s.isKeyPressed("KeyW")?this.transform.position.addAssign(this.transform.forward.scale(l*t)):s.isKeyPressed("KeyS")&&this.transform.position.addAssign(this.transform.forward.scale(-l*t)),s.isKeyPressed("KeyA")?this.transform.position.addAssign(this.transform.right.scale(l*t)):s.isKeyPressed("KeyD")&&this.transform.position.addAssign(this.transform.right.scale(-l*t))}},B=()=>acro.registerBehavior("FlyCamera",P);E();k?.();(void 0)?.();B?.();})();
